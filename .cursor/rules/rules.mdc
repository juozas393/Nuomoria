---
description: >
  Nuomoria (Property Management System) â€“ Cursor taisyklÄ—s, kurios automatizuotai
  skatina geriausias praktikas: naÅ¡umas, Core Web Vitals, protingas krovimas, paveikslÄ—liÅ³ ir tinklo optimizacija,
  sauga, prieinamumas ir pastovus DX. SpalvÅ³ paletÄ—: #2F8481, #000000, #FFFFFF.
globs:
  - "**/*"
alwaysApply: true
---

palette:
  primary: "#2F8481"
  black: "#000000"
  white: "#FFFFFF"

# ======================================================
# âœ… BENDRI TIKSLAI (Cursor turi vadovautis jais generuodamas kodÄ…)
# ======================================================
goals:
  - "Pirmas vaizdas < 1.5s FCP, LCP < 2.5s, CLS < 0.1, INP < 200ms."
  - "Initial JS â‰¤ 180KB gzip, initial CSS â‰¤ 40KB, pavienis IMG â‰¤ 200KB (hero â‰¤ 350KB AVIF/WebP)."
  - "VirÅ¡ lenkimo krovimas prioritetinis, visa kita â€“ lazy ir on-demand."
  - "0 nereikalingÅ³ priklausomybiÅ³ ir jokiÅ³ *runtime* prop-types â€“ tik TypeScript."
  - "Saugus Supabase naudojimas (RLS), tik bÅ«tini stulpeliai, paginacija pagal nutylÄ—jimÄ…."
  - "UI spalvos tik iÅ¡ paletÄ—s (primary/black/white)."

# ======================================================
# ğŸ§± TECH STACK & KODO STILIUS
# ======================================================
rules:

- name: "Tik TypeScript + grieÅ¾ti tipai"
  require:
    - "Nauji failai .ts/.tsx; vengti 'any'."
    - "Props apraÅ¡yti interface/type; bendrinami tipai â€“ src/types/."
  forbid:
    - "PropTypes, 'as unknown as', nestruktÅ«rizuoti any."

- name: "ESLint/Prettier disciplina"
  enforce:
    - "Gerbti projektines .eslintrc/.prettierrc nuostatas, importÅ³ tvarkÄ…."
    - "Production'e draudÅ¾iami console.*; vietoj to naudoti util Logger su NODE_ENV guard."

- name: "Aplinkos kintamieji"
  require:
    - ".env.local su REACT_APP_*; jokio hardcoded raktÅ³."
    - "KonfigÅ«racijai naudoti src/lib/config.ts (viena vieta)."

# ======================================================
# âš¡ REACT NAÅ UMAS
# ======================================================

- name: "Route-level code splitting"
  require:
    - "Visi puslapiai per React.lazy + Suspense; fallback = skeleton."
  snippet: |
    const TenantsPage = React.lazy(() => import("./pages/TenantsPage"));
    <Suspense fallback={<SkeletonList rows={8}/>}>
      <TenantsPage/>
    </Suspense>

- name: "KomponentÅ³ memoizavimas ir sÄ…raÅ¡Å³ virtualizacija"
  enforce:
    - "Pure UI -> React.memo; brangias iÅ¡raiÅ¡kas dÄ—k Ä¯ useMemo/useCallback."
    - "â‰¥50 eiluÄiÅ³ sÄ…raÅ¡ams â€“ react-window arba react-virtualized."
  snippet: |
    import { FixedSizeList as List } from "react-window";
    <List height={480} width={"100%"} itemCount={items.length} itemSize={56}>
      {Row}
    </List>

- name: "Error & Suspense boundary"
  require:
    - "Bendras AppErrorBoundary ir per-route boundary; rodyti atstatymo veiksmÄ…."
  snippet: |
    function AppErrorBoundary({ children }: { children: React.ReactNode }) {
      return (
        <ErrorBoundary fallback={<ErrorView/>}>
          <Suspense fallback={<AppSkeleton/>}>{children}</Suspense>
        </ErrorBoundary>
      );
    }

# ======================================================
# ğŸ–¼ï¸ PAVEIKSLÄ–LIAI (GREITAS Ä®KÄ–LIMAS)
# ======================================================

- name: "OptimizedImage â€“ privalomas visiems IMG"
  require:
    - "Visur vietoj <img> naudoti <OptimizedImage/> (arba <picture>), su AVIF/WebP srcset, sizes."
    - "BÅ«tini width/height, loading='lazy' (iÅ¡skyrus hero), decoding='async'."
    - "Blur/LQIP placeholder (dataURL) + IntersectionObserver prieÅ¡ tikrÄ… Ä¯kÄ—limÄ…."
  snippet: |
    // src/components/OptimizedImage.tsx
    type ImgProps = {
      alt: string; width: number; height: number; className?: string;
      src: string; webp?: string; avif?: string;
      sizes?: string; priority?: boolean; placeholderDataURL?: string;
    };
    export default function OptimizedImage(p: ImgProps) {
      const { priority, sizes="100vw" } = p;
      return (
        <picture>
          {p.avif && <source type="image/avif" srcSet={p.avif} sizes={sizes} />}
          {p.webp && <source type="image/webp" srcSet={p.webp} sizes={sizes} />}
          <img
            src={p.src} alt={p.alt} width={p.width} height={p.height}
            loading={priority ? "eager" : "lazy"} decoding="async"
            fetchPriority={(priority ? "high" : "auto") as any}
            className={p.className} />
        </picture>
      );
    }

- name: "Å altiniÅ³ generavimas ir dydÅ¾iai"
  actions:
    - "Kurti 1x/2x/3x versijas; generuoti srcset; SVG ikonoms naudoti SVGR."
    - "Hero: vienas paveikslas, priority=true, preloading su <link rel='preload' as='image'>."

# ======================================================
# ğŸ¨ TAILWIND & UI TEMA
# ======================================================

- name: "Spalvos ir Tailwind content"
  require:
    - "Naudoti tik: #2F8481, #000000, #FFFFFF; iÅ¡plÄ—sti tailwind colors.primary."
    - "Tailwind content = ./src/**/*.{ts,tsx,html} (purge)."
  snippet: |
    // tailwind.config.ts
    export default {
      content: ["./src/**/*.{ts,tsx,html}"],
      theme: { extend: { colors: { primary: "#2F8481", black: "#000", white: "#fff" } } }
    }

- name: "KomponentÅ³ etalonai"
  snippet: |
    export function PrimaryButton(props: React.ButtonHTMLAttributes<HTMLButtonElement>) {
      return (
        <button {...props}
          className={"rounded-2xl px-4 py-2 bg-primary text-white hover:opacity-90 " +
                     "focus:outline-none focus:ring-2 focus:ring-primary/40 " +
                     (props.className ?? "")}/>
      );
    }

# ======================================================
# ğŸ”Œ SUPABASE: UÅ½KLAUSOS IR SAUGA
# ======================================================

- name: "MinimalÅ«s duomenys + paginacija pagal nutylÄ—jimÄ…"
  require:
    - "Kiekviena .from().select() â€“ tik bÅ«tini stulpeliai; privalomas range(limit)."
    - "Nenaudoti SELECT *; naudoti order + indeksuojamus laukus."
  snippet: |
    const PAGE = 0, SIZE = 20;
    const { data, error } = await supabase
      .from("tenants")
      .select("id,full_name,apartment_id")
      .order("full_name")
      .range(PAGE*SIZE, PAGE*SIZE + SIZE - 1);

- name: "RLS ir vaidmenys"
  enforce:
    - "RLS Ä¯jungtas visoms lentelÄ—ms; RBAC per policies."
    - "Edge Functions jautriems veiksmams."

- name: "Realtime â€“ tik kai reikia"
  actions:
    - "Subscribe tik aktyviems ekranams; unmount â†’ .unsubscribe()."
    - "Debounce keitimams, batch'inti UI atnaujinimus."

# ======================================================
# ğŸŒ NETWORK, CACHE, PWA
# ======================================================

- name: "Greitas tinklas"
  actions:
    - "public/index.html: <link rel='preconnect' href='https://<project>.supabase.co' crossorigin>."
    - "CDN static: Cache-Control immutable, content hashing."
    - "ETag ir gzip/brotli Ä¯jungti serveryje."

- name: "Service Worker (Workbox)"
  actions:
    - "Static -> Cache First su revision; API -> Stale-While-Revalidate 30â€“60s."
    - "Image -> Cache First su maxEntries ir maxAgeSeconds."
  snippet: |
    // workbox routing pseudo:
    workbox.routing.registerRoute(({request}) => request.destination === "image",
      new workbox.strategies.CacheFirst({ cacheName: "img", plugins:[ new workbox.expiration.ExpirationPlugin({maxEntries:200,maxAgeSeconds:60*60*24*30}) ] }));

# ======================================================
# ğŸ§  UX: PERCEIVED PERFORMANCE
# ======================================================

- name: "Skeletons, prefetch, priority"
  require:
    - "Kiekvienas lÄ—tas ekranas turi skeleton."
    - "onHover/onView â€“ prefetch'inti route'us ir kritinius modulius."
  snippet: |
    import { prefetch } from "vite-plugin-prefetch"; // ar lygiavertis sprendimas

- name: "Debounce/Throttle"
  enforce:
    - "PaieÅ¡ka: debounce 250â€“400ms; scroll/resize throttle 100â€“200ms."

# ======================================================
# â™¿ PRIEINAMUMAS (A11y)
# ======================================================

- name: "A11y kaip numatytasis"
  require:
    - "Semantiniai elementai, alt visiems vaizdams, focus Å¾iedas neiÅ¡jungiamas."
    - "Kontrastas â‰¥ 4.5:1 (primary (#2F8481) ant balto â€“ OK)."
    - "ARIA tik kur bÅ«tina; formoms â€“ aiÅ¡kÅ«s labeliai ir klaidÅ³ bÅ«senos."

# ======================================================
# ğŸ”’ SAUGA
# ======================================================

- name: "CSP + XSS higiena"
  actions:
    - "Content-Security-Policy be 'unsafe-inline'; naudoti hash/nonce, jei reikia."
    - "Sanituoti vartotojo turinÄ¯ (DOMPurify), jokio dangerouslySetInnerHTML."

# ======================================================
# ğŸ“ˆ ANALITIKA IR MONITORINGAS
# ======================================================

- name: "Core Web Vitals ir klaidos"
  actions:
    - "web-vitals siÅ³sti Ä¯ analitikÄ… (INP, LCP, CLS)."
    - "Global error listener + Sentry/Analogas tik production."
  snippet: |
    import { onCLS, onINP, onLCP } from "web-vitals";
    [onCLS, onINP, onLCP].forEach(fn => fn(m => sendToAnalytics(m)));

# ======================================================
# ğŸ§ª CI VARTAI (kokybÄ—s uÅ¾raktai)
# ======================================================

- name: "CI privaloma praeiti"
  require:
    - "Type-check be klaidÅ³; ESLint be klaidÅ³."
    - "Bundle biudÅ¾etai nevirÅ¡yti; analyze ataskaita PR'e."
    - "Lighthouse perf â‰¥ 90 (mobile), a11y â‰¥ 90."
  snippet: |
    // package.json (fragmentas)
    "scripts": {
      "analyze": "source-map-explorer 'build/static/js/*.js' --html build/report.html",
      "perf:ci": "lighthouse http://localhost:3000 --preset=desktop --output=json --output-path=./lh.json"
    }

# ======================================================
# ğŸ¯ SPALVÅ² NAUDOJIMAS (privaloma)
# ======================================================

- name: "PaletÄ—s taikymas"
  require:
    - "CTA/bg akcentai â€“ #2F8481; pagrindinis tekstas â€“ #000; fonai â€“ #fff."
    - "Tailwind klasÄ—s: bg-[#2F8481] | text-black | bg-white | border-black/10."
